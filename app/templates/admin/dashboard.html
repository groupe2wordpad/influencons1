{% extends 'admin/base.html' %}

{% block page_title %}Tableau de bord{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('main.index') }}" class="btn btn-ghost" target="_blank">üåê Voir le site</a>
{% endblock %}

{% block content %}

<!-- ‚îÄ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-icon">üìù</div>
    <div class="num">{{ stats.articles }}</div>
    <div class="label">Articles</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">üéØ</div>
    <div class="num">{{ stats.defis }}</div>
    <div class="label">D√©fis</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">ü§ù</div>
    <div class="num">{{ stats.solidarite }}</div>
    <div class="label">Actions</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">üí¨</div>
    <div class="num">{{ stats.topics }}</div>
    <div class="label">Sujets forum</div>
  </div>
  <div class="stat-card stat-card--gold">
    <div class="stat-icon">üìß</div>
    <div class="num">{{ stats.subscribers }}</div>
    <div class="label">Abonn√©s newsletter</div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ TABLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="dashboard-grid">

  <!-- Derniers articles -->
  <div class="table-wrap">
    <div class="table-header">
      <h3>Derniers articles</h3>
      <a href="{{ url_for('admin.article_new') }}" class="btn btn-gold">+ Nouveau</a>
    </div>
    <table>
      <thead>
        <tr>
          <th>Titre</th>
          <th>Statut</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for art in recent_articles %}
        <tr>
          <td>
            <a href="{{ url_for('admin.article_edit', id=art.id) }}" class="table-link">
              {{ art.title[:40] }}{% if art.title|length > 40 %}‚Ä¶{% endif %}
            </a>
          </td>
          <td>
            <span class="badge {% if art.is_published %}badge-success{% else %}badge-muted{% endif %}">
              {% if art.is_published %}Publi√©{% else %}Brouillon{% endif %}
            </span>
          </td>
          <td class="date-cell">{{ art.created_at.strftime('%d/%m/%Y') }}</td>
          <td class="actions-cell">
            <a href="{{ url_for('admin.article_edit', id=art.id) }}" class="action-btn action-btn--edit" title="Modifier">‚úèÔ∏è</a>
            <button onclick="confirmDelete('{{ url_for('admin.article_delete', id=art.id) }}', '{{ art.title[:30] | e }}')" class="action-btn action-btn--delete" title="Supprimer">üóëÔ∏è</button>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" class="empty-row">Aucun article pour le moment</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Derniers abonn√©s -->
  <div class="table-wrap">
    <div class="table-header">
      <h3>Derniers abonn√©s newsletter</h3>
      <a href="{{ url_for('admin.newsletter') }}" class="btn btn-ghost">Voir tout</a>
    </div>
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for sub in recent_subscribers %}
        <tr>
          <td class="email-cell">{{ sub.email }}</td>
          <td class="date-cell">{{ sub.created_at.strftime('%d/%m/%Y') }}</td>
          <td>
            <span class="badge {% if sub.is_active %}badge-success{% else %}badge-muted{% endif %}">
              {% if sub.is_active %}Actif{% else %}Inactif{% endif %}
            </span>
          </td>
          <td class="actions-cell">
            <a href="{{ url_for('admin.newsletter_toggle', id=sub.id) }}" class="action-btn action-btn--edit" title="Activer / D√©sactiver">üîÑ</a>
            <button onclick="confirmDelete('{{ url_for('admin.newsletter_delete', id=sub.id) }}', '{{ sub.email | e }}')" class="action-btn action-btn--delete" title="Supprimer">üóëÔ∏è</button>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" class="empty-row">Aucun abonn√© pour le moment</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

<!-- ‚îÄ‚îÄ‚îÄ D√âFIS & SOLIDARIT√â ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="dashboard-grid" style="margin-top:1.5rem;">

  <!-- D√©fis -->
  <div class="table-wrap">
    <div class="table-header">
      <h3>D√©fis actifs</h3>
      <a href="{{ url_for('admin.defi_new') }}" class="btn btn-gold">+ Nouveau</a>
    </div>
    <table>
      <thead>
        <tr><th>Titre</th><th>Statut</th><th>Actions</th></tr>
      </thead>
      <tbody>
        {% for defi in recent_defis %}
        <tr>
          <td><a href="{{ url_for('admin.defi_edit', id=defi.id) }}" class="table-link">{{ defi.title[:40] }}{% if defi.title|length > 40 %}‚Ä¶{% endif %}</a></td>
          <td><span class="badge {% if defi.is_active %}badge-success{% else %}badge-muted{% endif %}">{% if defi.is_active %}Actif{% else %}Inactif{% endif %}</span></td>
          <td class="actions-cell">
            <a href="{{ url_for('admin.defi_edit', id=defi.id) }}" class="action-btn action-btn--edit" title="Modifier">‚úèÔ∏è</a>
            <button onclick="confirmDelete('{{ url_for('admin.defi_delete', id=defi.id) }}', '{{ defi.title[:30] | e }}')" class="action-btn action-btn--delete" title="Supprimer">üóëÔ∏è</button>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="3" class="empty-row">Aucun d√©fi pour le moment</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Solidarit√© -->
  <div class="table-wrap">
    <div class="table-header">
      <h3>Actions de solidarit√©</h3>
      <a href="{{ url_for('admin.solidarite_new') }}" class="btn btn-gold">+ Nouveau</a>
    </div>
    <table>
      <thead>
        <tr><th>Titre</th><th>Statut</th><th>Actions</th></tr>
      </thead>
      <tbody>
        {% for action in recent_solidarite %}
        <tr>
          <td><a href="{{ url_for('admin.solidarite_edit', id=action.id) }}" class="table-link">{{ action.title[:40] }}{% if action.title|length > 40 %}‚Ä¶{% endif %}</a></td>
          <td><span class="badge {% if action.is_active %}badge-success{% else %}badge-muted{% endif %}">{% if action.is_active %}Active{% else %}Inactive{% endif %}</span></td>
          <td class="actions-cell">
            <a href="{{ url_for('admin.solidarite_edit', id=action.id) }}" class="action-btn action-btn--edit" title="Modifier">‚úèÔ∏è</a>
            <button onclick="confirmDelete('{{ url_for('admin.solidarite_delete', id=action.id) }}', '{{ action.title[:30] | e }}')" class="action-btn action-btn--delete" title="Supprimer">üóëÔ∏è</button>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="3" class="empty-row">Aucune action pour le moment</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
<div class="quick-actions">
  <p class="quick-actions__label">Actions rapides</p>
  <div class="quick-actions__grid">
    <a href="{{ url_for('admin.article_new') }}" class="quick-btn quick-btn--gold">
      <span class="quick-btn__icon">üìù</span>
      <span>Nouvel article</span>
    </a>
    <a href="{{ url_for('admin.defi_new') }}" class="quick-btn">
      <span class="quick-btn__icon">üéØ</span>
      <span>Nouveau d√©fi</span>
    </a>
    <a href="{{ url_for('admin.solidarite_new') }}" class="quick-btn">
      <span class="quick-btn__icon">ü§ù</span>
      <span>Nouvelle action</span>
    </a>
    <a href="{{ url_for('admin.forum_new') }}" class="quick-btn">
      <span class="quick-btn__icon">üí¨</span>
      <span>Nouveau sujet</span>
    </a>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ STYLES SP√âCIFIQUES AU DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<style>
/* ‚îÄ‚îÄ Stats grid ‚îÄ‚îÄ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}
.stat-card {
  background: #fff;
  border-radius: 14px;
  padding: 1.5rem 1.2rem;
  text-align: center;
  border: 1px solid rgba(201,168,76,0.12);
  transition: transform .3s, box-shadow .3s;
}
.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(30,17,64,0.1);
}
.stat-card--gold {
  background: linear-gradient(135deg, var(--violet-deep, #1e1140), var(--violet, #2d1a52));
  border-color: transparent;
}
.stat-card--gold .num,
.stat-card--gold .label,
.stat-card--gold .stat-icon { color: var(--gold, #c9a84c) !important; }

.stat-icon { font-size: 1.4rem; margin-bottom: .4rem; }
.stat-card .num {
  font-family: 'Cormorant Garamond', serif;
  font-size: 2.6rem; font-weight: 600; line-height: 1;
  color: var(--violet-deep, #1e1140);
  margin-bottom: .3rem;
}
.stat-card .label {
  font-size: 0.72rem; font-weight: 500;
  letter-spacing: 0.12em; text-transform: uppercase;
  color: var(--text-light, #7a6a99);
}

/* ‚îÄ‚îÄ Dashboard grid ‚îÄ‚îÄ */
.dashboard-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 1.5rem;
}

/* ‚îÄ‚îÄ Table wrap ‚îÄ‚îÄ */
.table-wrap {
  background: #fff;
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid rgba(201,168,76,0.12);
}
.table-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 1.2rem 1.5rem;
  border-bottom: 1px solid rgba(201,168,76,0.1);
}
.table-header h3 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.2rem; font-weight: 600;
  color: var(--violet-deep, #1e1140);
}
table { width: 100%; border-collapse: collapse; }
thead th {
  padding: .75rem 1.5rem;
  font-size: 0.65rem; font-weight: 500;
  letter-spacing: 0.18em; text-transform: uppercase;
  color: var(--text-light, #7a6a99);
  text-align: left;
  border-bottom: 1px solid rgba(201,168,76,0.08);
}
tbody tr { transition: background .2s; }
tbody tr:hover { background: rgba(201,168,76,0.04); }
tbody td { padding: .85rem 1.5rem; font-size: 0.88rem; }

.table-link {
  color: var(--gold, #c9a84c);
  text-decoration: none;
  font-weight: 500;
  transition: color .2s;
}
.table-link:hover { color: var(--violet-deep, #1e1140); }

.date-cell { color: var(--text-light, #7a6a99); font-size: 0.78rem; }
.email-cell { font-size: 0.83rem; color: var(--text-dark, #1a1025); }
.empty-row {
  text-align: center;
  color: var(--text-light, #7a6a99);
  padding: 2rem !important;
  font-style: italic;
  font-size: 0.85rem;
}

/* ‚îÄ‚îÄ Badges ‚îÄ‚îÄ */
.badge {
  display: inline-block;
  padding: .25rem .75rem;
  border-radius: 100px;
  font-size: 0.65rem; font-weight: 500;
  letter-spacing: 0.1em; text-transform: uppercase;
}
.badge-success {
  background: rgba(201,168,76,0.15);
  color: #7a5c10;
}
.badge-muted {
  background: rgba(122,106,153,0.12);
  color: var(--text-light, #7a6a99);
}

/* ‚îÄ‚îÄ Quick actions ‚îÄ‚îÄ */
.quick-actions { margin-top: .5rem; }
.quick-actions__label {
  font-size: 0.65rem; font-weight: 500;
  letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--text-light, #7a6a99);
  margin-bottom: .75rem;
}
.quick-actions__grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
}
.quick-btn {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: .5rem; padding: 1.2rem 1rem;
  background: #fff; border-radius: 14px;
  border: 1px solid rgba(201,168,76,0.15);
  font-size: 0.78rem; font-weight: 500;
  letter-spacing: 0.08em;
  color: var(--violet-deep, #1e1140);
  text-decoration: none;
  transition: all .3s;
}
.quick-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(30,17,64,0.1);
  border-color: var(--gold, #c9a84c);
  color: var(--gold, #c9a84c);
}
.quick-btn--gold {
  background: var(--violet-deep, #1e1140);
  color: var(--gold, #c9a84c);
  border-color: transparent;
}
.quick-btn--gold:hover {
  background: var(--violet, #2d1a52);
  color: var(--gold-light, #e0c068);
}
.quick-btn__icon { font-size: 1.4rem; }

/* ‚îÄ‚îÄ Action buttons ‚îÄ‚îÄ */
.actions-cell { white-space: nowrap; }
.action-btn {
  display: inline-flex; align-items: center; justify-content: center;
  width: 32px; height: 32px; border-radius: 8px;
  border: none; cursor: pointer; font-size: 0.9rem;
  text-decoration: none;
  transition: all .2s;
  background: transparent;
}
.action-btn--edit  { background: rgba(201,168,76,0.1); }
.action-btn--edit:hover  { background: rgba(201,168,76,0.25); transform: scale(1.1); }
.action-btn--delete { background: rgba(220,60,60,0.08); margin-left: 4px; }
.action-btn--delete:hover { background: rgba(220,60,60,0.2); transform: scale(1.1); }

/* ‚îÄ‚îÄ Delete modal ‚îÄ‚îÄ */
.delete-modal-backdrop {
  display: none; position: fixed; inset: 0; z-index: 9999;
  background: rgba(20,12,40,0.65); backdrop-filter: blur(6px);
  align-items: center; justify-content: center;
}
.delete-modal-backdrop.open { display: flex; }
.delete-modal {
  background: #fff; border-radius: 20px;
  padding: 2.5rem; max-width: 420px; width: 90%;
  text-align: center;
  box-shadow: 0 40px 80px rgba(30,17,64,0.3);
  animation: fadeUp .3s ease both;
}
.delete-modal__icon { font-size: 2.8rem; margin-bottom: 1rem; }
.delete-modal h3 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.5rem; color: var(--violet-deep, #1e1140);
  margin-bottom: .6rem;
}
.delete-modal p {
  font-size: 0.88rem; color: var(--text-light, #7a6a99);
  line-height: 1.6; margin-bottom: 1.8rem;
}
.delete-modal p strong { color: var(--violet-deep, #1e1140); }
.delete-modal__actions { display: flex; gap: .75rem; justify-content: center; }
.btn-cancel {
  padding: .75rem 1.8rem; border-radius: 100px;
  border: 1px solid rgba(201,168,76,0.25);
  background: transparent; color: var(--text-mid, #3d2d5c);
  font-size: 0.78rem; letter-spacing: .12em; text-transform: uppercase;
  cursor: pointer; transition: all .2s;
}
.btn-cancel:hover { background: var(--cream-dark, #ede8dc); }
.btn-danger {
  padding: .75rem 1.8rem; border-radius: 100px;
  border: none; background: #c0392b; color: #fff;
  font-size: 0.78rem; letter-spacing: .12em; text-transform: uppercase;
  cursor: pointer; transition: all .2s;
}
.btn-danger:hover { background: #a93226; transform: translateY(-1px); }
@media (max-width: 900px) {
  .dashboard-grid { grid-template-columns: 1fr; }
  .quick-actions__grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 560px) {
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .quick-actions__grid { grid-template-columns: 1fr 1fr; }
}
</style>

<!-- ‚îÄ‚îÄ‚îÄ MODALE CONFIRMATION SUPPRESSION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="delete-modal-backdrop" id="deleteModal">
  <div class="delete-modal">
    <div class="delete-modal__icon">üóëÔ∏è</div>
    <h3>Confirmer la suppression</h3>
    <p>Vous √™tes sur le point de supprimer :<br><strong id="deleteItemName"></strong><br>Cette action est irr√©versible.</p>
    <div class="delete-modal__actions">
      <button class="btn-cancel" onclick="closeDeleteModal()">Annuler</button>
      <form id="deleteForm" method="POST" style="display:inline;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token is defined else '' }}">
        <button type="submit" class="btn-danger">Supprimer d√©finitivement</button>
      </form>
    </div>
  </div>
</div>

<script>
function confirmDelete(url, name) {
  document.getElementById('deleteItemName').textContent = name;
  document.getElementById('deleteForm').action = url;
  document.getElementById('deleteModal').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeDeleteModal() {
  document.getElementById('deleteModal').classList.remove('open');
  document.body.style.overflow = '';
}
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if (e.target === this) closeDeleteModal();
});
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeDeleteModal();
});
</script>

{% endblock %}
