{% extends 'admin/base.html' %}
{% block page_title %}Tableau de bord{% endblock %}
{% block topbar_actions %}
<a href="{{ url_for('main.index') }}" class="btn btn-ghost" target="_blank">ğŸŒ Voir le site</a>
{% endblock %}
{% block content %}
<div class="stats-grid">
  <div class="stat-card">
    <div class="num">{{ stats.articles }}</div>
    <div class="label">ğŸ“ Articles</div>
  </div>
  <div class="stat-card">
    <div class="num">{{ stats.defis }}</div>
    <div class="label">ğŸ¯ DÃ©fis</div>
  </div>
  <div class="stat-card">
    <div class="num">{{ stats.solidarite }}</div>
    <div class="label">ğŸ¤ Actions</div>
  </div>
  <div class="stat-card">
    <div class="num">{{ stats.topics }}</div>
    <div class="label">ğŸ’¬ Sujets forum</div>
  </div>
  <div class="stat-card">
    <div class="num">{{ stats.subscribers }}</div>
    <div class="label">ğŸ“§ AbonnÃ©s</div>
  </div>
</div>

<div style="display:grid; grid-template-columns:1fr 1fr; gap:24px;">
  <div class="table-wrap">
    <div class="table-header">
      <h3>Derniers articles</h3>
      <a href="{{ url_for('admin.article_new') }}" class="btn btn-gold">+ Nouveau</a>
    </div>
    <table>
      <thead><tr><th>Titre</th><th>Statut</th><th>Date</th></tr></thead>
      <tbody>
        {% for art in recent_articles %}
        <tr>
          <td><a href="{{ url_for('admin.article_edit', id=art.id) }}" style="color:var(--or); text-decoration:none;">{{ art.title[:40] }}{% if art.title|length > 40 %}â€¦{% endif %}</a></td>
          <td><span class="badge {% if art.is_published %}badge-success{% else %}badge-muted{% endif %}">{% if art.is_published %}PubliÃ©{% else %}Brouillon{% endif %}</span></td>
          <td style="color:var(--text-muted); font-size:0.8rem;">{{ art.created_at.strftime('%d/%m/%Y') }}</td>
        </tr>
        {% else %}
        <tr><td colspan="3" style="text-align:center; color:var(--text-muted); padding:24px;">Aucun article</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="table-wrap">
    <div class="table-header">
      <h3>Derniers abonnÃ©s newsletter</h3>
      <a href="{{ url_for('admin.newsletter') }}" class="btn btn-ghost">Voir tout</a>
    </div>
    <table>
      <thead><tr><th>Email</th><th>Date</th><th>Statut</th></tr></thead>
      <tbody>
        {% for sub in recent_subscribers %}
        <tr>
          <td style="font-size:0.85rem;">{{ sub.email }}</td>
          <td style="color:var(--text-muted); font-size:0.8rem;">{{ sub.created_at.strftime('%d/%m/%Y') }}</td>
          <td><span class="badge {% if sub.is_active %}badge-success{% else %}badge-muted{% endif %}">{% if sub.is_active %}Actif{% else %}Inactif{% endif %}</span></td>
        </tr>
        {% else %}
        <tr><td colspan="3" style="text-align:center; color:var(--text-muted); padding:24px;">Aucun abonnÃ©</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div style="margin-top:24px; display:grid; grid-template-columns:repeat(4,1fr); gap:16px;">
  <a href="{{ url_for('admin.article_new') }}" class="btn btn-gold" style="justify-content:center; padding:16px;">ğŸ“ Nouvel article</a>
  <a href="{{ url_for('admin.defi_new') }}" class="btn btn-ghost" style="justify-content:center; padding:16px;">ğŸ¯ Nouveau dÃ©fi</a>
  <a href="{{ url_for('admin.solidarite_new') }}" class="btn btn-ghost" style="justify-content:center; padding:16px;">ğŸ¤ Nouvelle action</a>
  <a href="{{ url_for('admin.forum_new') }}" class="btn btn-ghost" style="justify-content:center; padding:16px;">ğŸ’¬ Nouveau sujet</a>
</div>
{% endblock %}
